version: 2.1

setup: true

orbs:
  path-filtering: circleci/path-filtering@0.0.2
  continuation: circleci/continuation@0.1.2
  circleci-cli: circleci/circleci-cli@0.1.9

executors:
  base:
    docker:
      - image: cimg/base:stable

jobs:
  run_some_checks:
    executor: base
    steps:
      - checkout

  prepare_for_next:
    executor: base
    steps:
      - checkout
      - circleci-cli/install
      - run:
          name: Set Version
          command: |
            echo "version: 2.1" >> continue-config.yml
      - run:
          name: Create Config
          command: |
            circleci config pack .circleci/primary >> continue-config.yml
      - run:
          name: Validate Config
          command: |
            circleci config validate continue-config.yml
      - continuation/continue:
          configuration_path: ~/continue_config.yml

workflows:
  setup-workflow:
    jobs:
      - run_some_checks
      - prepare_for_next:
          requires:
            - run_some_checks
